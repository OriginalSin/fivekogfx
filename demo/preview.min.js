/*
 Created by FIVEKO.com 2017

 The source code is designed and developed for educational purposes only. 
 It is designed for no other purpose and neither the authors nor their institutions 
 accept any liability concerning its use.

*/
window.addEventListener("load",function(k){function r(a){var b=a.width||a.videoWidth;a=a.height||a.videoHeight;var c=(480<document.documentElement.clientWidth?480:document.documentElement.clientWidth-100)/Math.max(b,a);d.width=b*c;d.height=a*c}function t(a,b){var c=document.getElementsByTagName("video")[0];if(!c){var v=function(){c.play();c.muted=!0;r(c);clearInterval(f);f=setInterval(function(){u.update()},30)},f,c=document.createElement("video");c.addEventListener("canplaythrough",v,!0);c.addEventListener("ended",
function(){clearInterval(f)},!0);d.onclick=function(){c.paused?v():(c.pause(),clearInterval(f))}}q=c;c.src=a}function w(a,b){l.onload=function(){r(l);d.getContext("2d").drawImage(l,0,0,d.width,d.height);b()};a?l.src=a:b();q=l}function x(a,b,c,d){this.controls=[];this.name=a;this.init=function(){this.controls=[];b.call(this);this.update.call(this)};this.update=function(){var a=new Date;d.call(this);for(var b=[],e=0;e<this.controls.length;e++)b.push(this.controls[e].value);c.apply(this,b);b=new Date;
document.getElementById("log").innerText="Elapsed: "+(b-a)+" ms"};this.reset=d}if(k=document.querySelector("div[data-role=preview]")){var u=null,l=new Image,q=l,d=document.createElement("canvas");(function(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.setAttribute("type","text/css");c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a));b.appendChild(c)})(".input-group-addon.title{min-width:120px;}.input-group-addon.value{width:60px;}");
var g=document.createElement("div"),m=document.createElement("input"),n=document.createElement("button"),p=document.createElement("button"),e=document.createElement("select");m.setAttribute("type","file");m.style.display="none";m.addEventListener("change",function(a){var b=URL.createObjectURL(a.target.files[0]);a=a.target.files[0].type;(a="image"==a.substring(0,5)?w:"video"==a.substring(0,5)?t:null)&&a(b,function(){URL.revokeObjectURL(b)})});p.textContent="Camera";p.style.margin="10px";p.style.width=
"100px";n.textContent="Browse";n.style.margin="10px";n.style.width="100px";n.onclick=function(){m.click();return!1};p.onclick=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;navigator.getUserMedia&&navigator.getUserMedia({video:!0},function(a){var b=window.URL.createObjectURL(a);t(b,function(){URL.revokeObjectURL(b)})},function(a){alert("Failed to initialize camera!")})};e.onchange=
function(){document.getElementById("controls").innerHTML="";var a=this.options[this.selectedIndex].filter;u=this.options[this.selectedIndex].filter;a.init();return!1};k.insertBefore(d,k.firstChild);k.insertBefore(g,k.firstChild);g.appendChild(m);g.appendChild(n);g.appendChild(p);g.appendChild(e);window.reloadImage=function(){d.getContext("2d").drawImage(l,0,0,d.width,d.height)};window.redraw=function(){d.getContext("2d").drawImage(q,0,0,d.width,d.height)};x.prototype.add=function(a){this.controls.push(a)};
window.selectFilter=function(a){e.style.display="none";for(var b=0;b<e.options.length;b++)if(e.options[b].text===a){e.selectedIndex=b;break}};window.addFilter=function(a){var b=document.createElement("option");b.text=a.name;b.filter=a;e.add(b)};window.Filter=x;window.createSlider=function(a,b,c,d,f,e,k,l){var g=document.createElement("div");g.innerHTML='<div class="input-group" style="max-width:420px; margin:auto;"><span class="input-group-addon title">'+c+'</span><input type="range" class="form-control" id="'+
b+'" ><span class="input-group-addon value">'+d+"</span></div>";a.appendChild(g);var h=document.getElementById(b);h.min=f;h.max=e;h.step=k;h.value=d;h.oninput=h.onchange=function(a){h.nextSibling.innerText=this.value};h.onmouseup=h.ontouchend=l;return h};window.createButton=function(a,b,c,d){var f=document.createElement("button");f.addClass="btn btn-primary";f.innerText=c;f.name=b;f.onclick=d;a.appendChild(f);return f};window.createSelector=function(a,b){var c={x:0,y:0,w:0,h:0},d={canvas:a,value:null};
a.onmousedown=function(a){c.x=a.offsetX;c.y=a.offsetY};a.onmousemove=function(b){b.buttons&&(c.w=b.offsetX-c.x,c.h=b.offsetY-c.y,b=a.getContext("2d"),redraw(),b.beginPath(),b.rect(c.x,c.y,c.w,c.h),b.stroke())};a.onmouseup=function(a){b(c)};return d};var g=k.getAttribute("data-source"),y=k.getAttribute("data-callback");w(g,function(){window[y](d,d);e.onchange();1===e.options.length&&(e.style.display="none")})}},!0);
