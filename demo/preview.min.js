/*
 Created by FIVEKO.com 2017

 The source code is designed and developed for educational purposes only. 
 It is designed for no other purpose and neither the authors nor their institutions 
 accept any liability concerning its use.

*/
window.addEventListener("load",function(e){function r(a){var b=a.width||a.videoWidth;a=a.height||a.videoHeight;var d=(480<document.documentElement.clientWidth?480:document.documentElement.clientWidth-100)/Math.max(b,a);c.width=b*d;c.height=a*d}function t(a,b){var d=document.getElementsByTagName("video")[0];if(!d){var v=function(){d.play();d.muted=!0;r(d);clearInterval(p);p=setInterval(function(){u.update()},30)},p,d=document.createElement("video");d.addEventListener("canplaythrough",v,!0);d.addEventListener("ended",
function(){clearInterval(p)},!0);c.onclick=function(){d.paused?v():(d.pause(),clearInterval(p))}}q=d;d.src=a}function w(a,b){g.onload=function(){r(g);c.getContext("2d").drawImage(g,0,0,c.width,c.height);b()};a?g.src=a:b();q=g}function x(a,b,d,c){this.controls=[];this.name=a;this.init=function(){this.controls=[];b.call(this);this.update.call(this)};this.update=function(){var a=new Date;c();for(var b=[],e=0;e<this.controls.length;e++)b.push(this.controls[e].value);d.apply(this,b);b=new Date;document.getElementById("log").innerText=
"Elapsed: "+(b-a)+" ms"};this.reset=c}if(e=document.querySelector("div[data-role=preview]")){var u=null,g=new Image,q=g,c=document.createElement("canvas"),h=document.createElement("div"),l=document.createElement("input"),m=document.createElement("button"),n=document.createElement("button"),k=document.createElement("select");l.setAttribute("type","file");l.style.display="none";l.addEventListener("change",function(a){var b=URL.createObjectURL(a.target.files[0]);a=a.target.files[0].type;(a="image"==
a.substring(0,5)?w:"video"==a.substring(0,5)?t:null)&&a(b,function(){URL.revokeObjectURL(b)})});n.textContent="Camera";n.style.margin="10px";n.style.width="100px";m.textContent="Browse";m.style.margin="10px";m.style.width="100px";m.onclick=function(){l.click();return!1};n.onclick=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;navigator.getUserMedia&&navigator.getUserMedia({video:!0},
function(a){var b=window.URL.createObjectURL(a);t(b,function(){URL.revokeObjectURL(b)})},function(a){alert("Failed to initialize camera!")})};k.onchange=function(){document.getElementById("controls").innerHTML="";var a=this.options[this.selectedIndex].filter;u=this.options[this.selectedIndex].filter;a.init();a.update();return!1};e.insertBefore(c,e.firstChild);e.insertBefore(h,e.firstChild);h.appendChild(l);h.appendChild(m);h.appendChild(n);h.appendChild(k);window.reloadImage=function(){c.getContext("2d").drawImage(g,
0,0,c.width,c.height)};window.redraw=function(){c.getContext("2d").drawImage(q,0,0,c.width,c.height)};x.prototype.add=function(a){this.controls.push(a)};window.addFilter=function(a){var b=document.createElement("option");b.text=a.name;b.filter=a;k.add(b)};window.Filter=x;window.createSlider=function(a,b,c,e,g,h,k,l){var d=document.createElement("div");d.innerHTML='<div class="input-group" style="max-width:420px; margin:auto;"><span class="input-group-addon title">'+c+'</span><input type="range" class="form-control" id="'+
b+'" ><span class="input-group-addon value">'+e+"</span></div>";a.appendChild(d);var f=document.getElementById(b);f.min=g;f.max=h;f.step=k;f.value=e;f.oninput=f.onchange=function(a){f.nextSibling.innerText=this.value};f.onmouseup=f.ontouchend=l;return f};var h=e.getAttribute("data-source"),y=e.getAttribute("data-callback");w(h,function(){window[y](c,c);k.onchange();1===k.options.length&&(k.style.display="none")})}},!0);
