/*
 Copyright (c) 2017 fiveko.com
 See the LICENSE file for copying permission.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,d){b!=Array.prototype&&b!=Object.prototype&&(b[a]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.polyfill=function(b,a,d,f){if(a){d=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var h=b[f];h in d||(d[h]={});d=d[h]}b=b[b.length-1];f=d[b];a=a(f);a!=f&&null!=a&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.from",function(b){return b?b:function(a,d,f){$jscomp.initSymbolIterator();d=null!=d?d:function(c){return c};var b=[],c=a[Symbol.iterator];if("function"==typeof c)for(a=c.call(a);!(c=a.next()).done;)b.push(d.call(f,c.value));else for(var c=a.length,g=0;g<c;g++)b.push(d.call(f,a[g]));return b}},"es6-impl","es3");
function FivekoGFX(b){function a(c){try{return c.getContext("webgl",{premultipliedAlpha:!1})||c.getContext("experimental-webgl",{premultipliedAlpha:!1})}catch(g){console.log("ERROR: %o",g)}return null}function d(c,g){var e=new XMLHttpRequest;e.open("GET",c,!1);e.onreadystatechange=function(){4!==e.readyState||200!==e.status&&0!=e.status||g(e.responseText);return g("")};e.send(null)}function f(c){var g=c.createTexture();c.bindTexture(c.TEXTURE_2D,g);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0);c.texParameteri(c.TEXTURE_2D,
c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);return g}function h(c,g,e){var a=c.getAttribLocation(g,"a_position"),f=c.getUniformLocation(g,"u_image");c.getUniformLocation(g,"u_matrix");g=c.getUniformLocation(g,"u_textureSize");c.vertexAttribPointer(a,2,c.FLOAT,!1,0,0);c.enableVertexAttribArray(a);var a=c.canvas.width,d=c.canvas.height;
c.bindFramebuffer(c.FRAMEBUFFER,e);c.uniform2f(g,a,d);c.uniform1i(f,0);c.viewport(0,0,a,d);c.drawArrays(c.TRIANGLES,0,6)}this.gl=b?a(b):a(document.createElement("canvas"));this.params={};this.programs={};this.sources={};FivekoGFX.prototype.createProgram=function(c,a,e){function g(c,e){var a=d.createShader(c);d.shaderSource(a,e);d.compileShader(a);return d.getShaderParameter(a,d.COMPILE_STATUS)?a:(alert("An error occurred compiling the shaders: "+d.getShaderInfoLog(a)),null)}var d=this.gl,f=this.programs[c];
if(f)return f;e=e?g(d.VERTEX_SHADER,e):g(d.VERTEX_SHADER,"attribute vec2 a_position;                     \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvoid main() { gl_Position = vec4(a_position, 0.0, 1.0); }");a=g(d.FRAGMENT_SHADER,a);f=d.createProgram();d.attachShader(f,e);d.attachShader(f,a);d.linkProgram(f);d.getProgramParameter(f,d.LINK_STATUS)?this.programs[c]=f:alert("Unable to initialize the shader program.");return f};FivekoGFX.prototype.createProgramFromFile=function(c,a,e,f){d(a,function(e){""!==e?
(e=createProgram(c,e),f(e)):f(null)})};FivekoGFX.prototype.deleteProgram=function(c){var a=this.gl,e=this.programs[c];e&&(a.deleteProgram(e),this.programs[c]=null)};FivekoGFX.prototype.initialize=function(c,a){var e=this.gl,d=e.canvas;if(!this.originalImageTexture||d.width!=c||d.height!=a){d.width=c;d.height=a;this.originalImageTexture=f(e);for(var g=[],b=[],h=0;2>h;++h){var k=f(e);g.push(k);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,d.width,d.height,0,e.RGBA,e.UNSIGNED_BYTE,null);var l=e.createFramebuffer();
b.push(l);e.bindFramebuffer(e.FRAMEBUFFER,l);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,k,0)}d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d);e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW);this.textures=g;this.framebuffers=b;this.count=0}};FivekoGFX.prototype.load=function(c){var a=this.gl;this.initialize(c.width,c.height);var e=window.performance.now();a.bindTexture(a.TEXTURE_2D,this.originalImageTexture);a.texImage2D(a.TEXTURE_2D,
0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c);console.log("Image loaded!Elapsed: "+(window.performance.now()-e).toString())};FivekoGFX.prototype.renderto=function(c,a){h(this.gl,c,a)};FivekoGFX.prototype.draw=function(c){var a=this.gl,e=this.createProgram("draw","precision mediump float;                                   \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tuniform sampler2D u_image;                                  \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tuniform vec2 u_textureSize;                                 \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvoid main() {                                               \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;       \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = texture2D(u_image, textCoord/*vec2(textCoord.x, 1.0 - textCoord.y)*/ );          \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}                                                           ");
a.useProgram(e);h(a,e,null);this.count=0;c&&c.getContext("2d").drawImage(a.canvas,0,0)};FivekoGFX.prototype.makeTextImage2D=function(c,a,e,d,f,b,h,k){e=this.gl;var g=e.createTexture();e.activeTexture(e.TEXTURE0+a);e.bindTexture(e.TEXTURE_2D,g);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texImage2D(e.TEXTURE_2D,0,b,d,f,0,b,h,k);c=e.getUniformLocation(c,"u_colorTable");
e.uniform1i(c,a);e.activeTexture(e.TEXTURE0)};FivekoGFX.prototype.readPixels=function(a){var c=this.gl;a||(a={data:new Uint8Array(c.canvas.width*c.canvas.height*4),width:c.canvas.width,height:c.canvas.height});c.readPixels(0,0,c.canvas.width,c.canvas.height,c.RGBA,c.UNSIGNED_BYTE,a.data);return a};FivekoGFX.prototype.getImageData=function(a,d,e,f){var c=this.gl,b=new Uint8Array(e*f*4);c.readPixels(a,c.drawingBufferHeight-d-f,e,f,c.RGBA,c.UNSIGNED_BYTE,b);return{data:b,width:e,height:f}};FivekoGFX.prototype.execute=
function(c){var a=this.gl;h(a,c,this.framebuffers[this.count%2]);a.bindTexture(a.TEXTURE_2D,this.textures[this.count%2]);++this.count}}FivekoGFX.params={};FivekoGFX.sources={};FivekoGFX.sourceText=function(b,a){return FivekoGFX.sources[b]};
FivekoGFX.prototype.loadShaders=function(b){function a(a,d){var c=document.getElementById(d);if(!c)return null;var f="",b=c.firstChild;for(console.log(a);b;)b.nodeType==b.TEXT_NODE&&(f+=b.textContent),b=b.nextSibling;if("x-shader/x-fragment"==c.type)c=a.createShader(a.FRAGMENT_SHADER);else if("x-shader/x-vertex"==c.type)c=a.createShader(a.VERTEX_SHADER);else return null;a.shaderSource(c,f);a.compileShader(c);return a.getShaderParameter(c,a.COMPILE_STATUS)?c:(alert("An error occurred compiling the shaders: "+
a.getShaderInfoLog(c)),null)}var d=this.gl,f=a(d,b[0]);b=a(d,b[1]);var h=d.createProgram();d.attachShader(h,b);d.attachShader(h,f);d.linkProgram(h);d.getProgramParameter(h,d.LINK_STATUS)||alert("Unable to initialize the shader program.");return h};(function(b){function a(a,f){var d=a.gl,c=a.createProgram("sobel","\nprecision mediump float;\n\n#define KERNEL_SIZE 3\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nuniform float u_kernel[KERNEL_SIZE];\n#define M_PI 3.1415926535897932384626433832795\n#define GET_PIXEL(_x, _y) (texture2D(u_image, textCoord + onePixel*vec2(_x, _y)))\n \n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tfloat dx = (length(GET_PIXEL(-1, -1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(-1,  0)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(-1, +1)*u_kernel[2]) -\n\t\t\t   length(GET_PIXEL(+1, -1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(+1,  0)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(+1, +1)*u_kernel[2]));\n\tfloat dy = (length(GET_PIXEL(-1, -1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(0, -1)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(+1, -1)*u_kernel[2]) -\n\t\t\t   length(GET_PIXEL(-1, +1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(0, +1)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(+1, +1)*u_kernel[2]));\n\n///gl_FragColor = vec4(vec3(length(vec2(dx, dy))), 1.0);\n   float theta = (atan(dy, dx) + M_PI) / (2.0*M_PI);\n   gl_FragColor = vec4(length(vec2(dx, dy)), theta, 0.0, 1.0);\n}");
d.useProgram(c);var b=d.getUniformLocation(c,"u_kernel[0]");d.uniform1fv(b,f);a.execute(c);d=a.gl;c=a.createProgram("edgeNMS","\nprecision mediump float;\n\n#define KERNEL_SIZE 3\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\n#define M_PI 3.1415926535897932384626433832795\n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec4 cc = texture2D(u_image, textCoord);   \n\tfloat theta = degrees(cc.y*M_PI*2.0); \n\tint ax = 0, ay = 0; \n\tif ((theta >= 337.5) || (theta < 22.5))       { ax = 1; ay = 0; }\n\telse if ((theta >= 22.5) && (theta < 67.5))   { ax = 1; ay = 1; }\n\telse if ((theta >= 67.5) && (theta < 112.5))  { ax = 0; ay = 1; }\n\telse if ((theta >= 112.5) && (theta < 157.5)) { ax =-1; ay = 1; }\n\telse if ((theta >= 157.5) && (theta < 202.5)) { ax =-1; ay = 0; }\n\telse if ((theta >=202.5) && (theta < 247.5))  { ax =-1; ay =-1; }\n\telse if ((theta >=247.5) && (theta < 292.5))  { ax = 0; ay =-1; }\n\telse if ((theta >= 292.5) && (theta < 337.5)) { ax = 1; ay =-1; }\n\n\tvec4 ca = texture2D(u_image, textCoord + onePixel*vec2(ax, ay));\n\tvec4 cb = texture2D(u_image, textCoord + onePixel*vec2(-ax, -ay));\n\tgl_FragColor = vec4((((cc.x <= ca.x) || (cc.x < cb.x)) ? vec3(0) : vec3(cc.x)), 1.0);\n}");
d.useProgram(c);a.execute(c)}b.prototype.sobel=function(){a(this,[1,2,1])};b.prototype.schaar=function(){a(this,[3,10,3])}})(window.FivekoGFX);(function(b){b.prototype.gauss=function(a){var d=this.gl,f=this.params.gauss;if(!f||f.sigma!==a){var f=Math.sqrt(2*Math.PI)*a,b=0,c=2*a*a,g,e=new Float32Array(15);var n=0;for(g=-7;15>n;g++,n++)e[n]=Math.exp(-(g*g)/c)/f,b+=e[n];for(g=0;15>g;g++)e[g]/=b;f={sigma:a,kernel:e};this.params.gauss=f}a=this.createProgram("gauss","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\n\n#define KERNEL_SIZE 15\nuniform vec2 u_textureSize;\nuniform int u_direction;\nuniform float u_kernel[KERNEL_SIZE];\nvoid main() {\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec2 onePixel = ((u_direction == 0) ? vec2(1.0, 0.0) : vec2(0.0, 1.0)) / u_textureSize;\n\tvec4 meanColor = vec4(0);\n\tint ms = KERNEL_SIZE / 2;\n\tfor (int i = 0; i < KERNEL_SIZE; i++)\n\t{\n\t\tmeanColor += texture2D(u_image, textCoord  + onePixel*vec2(i - ms))*u_kernel[i];\n\t}\n\tgl_FragColor = meanColor;\n}");
b=f.kernel;d.useProgram(a);c=d.getUniformLocation(a,"u_kernel[0]");f=d.getUniformLocation(a,"u_direction");d.uniform1fv(c,b);for(b=0;2>b;b++)d.uniform1i(f,b),this.execute(a)}})(window.FivekoGFX);(function(b){b.sources.mean="\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nvoid main() {\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tgl_FragColor = (\n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, 0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0,  0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0,  0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, 1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0,  1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0,  1.0))) / 9.0;\n}";
b.prototype.mean=function(){var a=this.gl,d=this.createProgram("mean","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nvoid main() {\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tgl_FragColor = (\n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, 0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0,  0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0,  0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, 1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0,  1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0,  1.0))) / 9.0;\n}");
a.useProgram(d);this.execute(d)};b.prototype.blur=function(a){a=12*a*a/8;var d=this.gl,f=this.createProgram("mean","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nvoid main() {\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tgl_FragColor = (\n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, 0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0,  0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0,  0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, 1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0,  1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0,  1.0))) / 9.0;\n}");
d.useProgram(f);for(d=0;d<a;d++)this.execute(f)}})(window.FivekoGFX);(function(b){b.prototype.symmetricnn=function(a,d){var f=this.params.symmetricnn;f&&f.size!==a&&this.deleteProgram("symmetricnn");this.params.symmetricnn={size:a};var b=this.gl,f=this.createProgram("symmetricnn","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nuniform int u_pixelsCount;\n#define KERNEL_SIZE %kernelSize%\n#define HALF_SIZE (KERNEL_SIZE / 2)\n\nvoid main() {\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec4 meanColor = vec4(0);\n\tvec4 v = texture2D(u_image, textCoord);\n\tint count = 0;\n\tfor (int y = 0; y <= HALF_SIZE; y++){\n\t\tfor (int x = -HALF_SIZE; x <= HALF_SIZE; x++){\n\t\t\tvec4 v1 = texture2D(u_image, textCoord + vec2(x, y) * onePixel);  \n\t\t\tvec4 v2 = texture2D(u_image, textCoord + vec2(-x, -y) * onePixel);\n\t\t\tvec4 d1 = abs(v - v1);\n\t\t\tvec4 d2 = abs(v - v2);\n\t\t\tvec4 rv = vec4(((d1[0] < d2[0]) ? v1[0] : v2[0]),\n\t\t\t\t\t\t\t((d1[1] < d2[1]) ? v1[1] : v2[1]),\n\t\t\t\t\t\t\t((d1[2] < d2[2]) ? v1[2] : v2[2]),1);\n\t\t\tmeanColor += rv;\n\t\t}\n\t}\n\tgl_FragColor = meanColor / float(u_pixelsCount);\n}".replace(/%kernelSize%/g,
a));b.useProgram(f);var c=(a+!(a%2))*((a+!(a%2))/2+.5),g=b.getUniformLocation(f,"u_pixelsCount");b.uniform1i(g,c);console.log("size:"+a+" count: "+c);for(b=0;b<d;b++)this.execute(f)}})(window.FivekoGFX);(function(b){b.prototype.houghCircle=function(a){var d=this.gl,b=this.createProgram("houghCircle","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nuniform float u_r;\n#define M_PI 3.1415926535897932384626433832795\n#define PHI_STEP M_PI/180.0\n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec4 sum = vec4(0.0);\n\tfloat phi = 0.0;\n\tfor (int i = 0; i < 360; i++)\n\t{\n\t\tphi += PHI_STEP;\n\t\tsum += texture2D(u_image, textCoord + onePixel*vec2(u_r*cos(phi), u_r*sin(phi)));\n\t}\n\t\n\tgl_FragColor = vec4(vec3(sum / 360.0), 1.0);\n}");
d.useProgram(b);d.uniform1f(d.getUniformLocation(b,"u_r"),a);this.execute(b)}})(window.FivekoGFX);(function(b){function a(a,b){var d=this.gl,c=this.createProgram(a,b);d.useProgram(c);this.execute(c)}b.prototype.rgb2grey=function(){a.call(this,"rgb2grey","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nvec4 scale = vec4(0.299,  0.587,  0.114, 0.0);\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tgl_FragColor = vec4(vec3(dot(color,scale)), color.a);\n}")};b.prototype.rgb2luma=function(){a.call(this,"rgb2lum",
shaderSourceRGB2LUMA)};b.prototype.rgb2ycbcr=function(){a.call(this,"rgb2ycbcr","\nprecision mediump float; \n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize; \nmat4 scale =   mat4(0.257,  0.504,  0.098, 0.0, \n                   -0.148, -0.291,  0.439, 0.0, \n                    0.439, -0.368, -0.071, 0.0, \n                    1.0, 1.0,  1.0, 1.0 );\n\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tgl_FragColor = color*scale + vec4(0.0625, 0.5, 0.5, 0);\n}")};
b.prototype.ycbcr2rgb=function(){a.call(this,"ycbcr2rgb","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nmat4 scale =   mat4(1.164,  0.000,  1.596, 0.0,\n                    1.164, -0.392, -0.813, 0.0,\n                    1.164,  2.017,  0.000, 0.0,\n                    1.0, 1.0,  1.0, 1.0 );\n\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tgl_FragColor = (color- vec4(0.0625, 0.5, 0.5, 0))*scale ;\n}")};
b.prototype.skinMask=function(){var a=this.gl,b=this.createProgram("skinMask","\nprecision mediump float;\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nvec4 thr = vec4(80.0/255.0, 120.0/255.0, 133.0/255.0, 173.0/255.0);\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tgl_FragColor = vec4(vec3(( (color[0] > thr[0]) && \n\t\t\t\t(color[1] >= thr[0]) && (color[1] <= thr[1]) && \n\t\t\t\t(color[2] >= thr[2]) && (color[2] <=thr[3])) ? 1.0 : 0.0), \n\t\t\t\tcolor.a);\n}");
this.rgb2ycbcr();a.useProgram(b);this.execute(b)};b.prototype.rgb2xyz=function(){a.call(this,"rgb2xyz","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\n#define SCALE(_c) (((_c) > 0.04045) ? (pow(((_c) + 0.055 ) / 1.055, 2.4)) : ((_c)/ 12.92))\nmat4 scale =   mat4(0.4124,  0.3576,  0.1805, 0.0, \n                    0.2126,  0.7152,  0.0722, 0.0, \n                    0.0193,  0.1192,  0.9505, 0.0, \n                    1.0, 1.0,  1.0, 1.0 );\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tvec4 rgb = vec4(SCALE(color.r), SCALE(color.g), SCALE(color.b), color.a); \n\tgl_FragColor = rgb*scale;\n}")};
b.prototype.rgb2hsl=function(){a.call(this,"rgb2hsl","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\n\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tfloat cMin = min(min(color.r, color.g), color.b);\n\tfloat cMax = max(max(color.r, color.g), color.b);\n\tfloat L = (cMax + cMin)/(2.0);\n\t\n\tif (cMin == cMax){\n\t\tgl_FragColor = vec4(vec3(0, 0, L), color.a); \n\t\treturn;\n\t}\n\t// Calc Saturation\n\tfloat delta = (cMax - cMin);\n\tfloat S = ((L > 0.5) ? (delta / (2.0 - cMax - cMin)) : (delta / (cMax + cMin)));\n\t\n\t// Calc Hue\n\tfloat H = (color.r == cMax) ? (((color.g - color.b) / delta)) :\n\t\t\t\t((color.g == cMax) ? (2.0 + (color.b - color.r) / delta) :\n\t\t\t\t((4.0 + (color.r - color.g) / delta)));\n\tH = ((H < 0.0) ? (H + 6.0) : H) / 6.0;\n\tgl_FragColor = vec4(vec3(H, S, L), color.a);\n}")};
b.prototype.colormap=function(a){var b=this.gl,d=this.createProgram("colormap","\nprecision mediump float;\n\n// our texture\nuniform vec2 u_textureSize;\nuniform sampler2D u_image;\nuniform sampler2D u_colorTable;\n\nvoid main() {\n\tvec2 pos = vec2(texture2D(u_image, gl_FragCoord.xy / u_textureSize).x, 0.0);\n\tvec4 color = texture2D(u_colorTable, pos);\n\t\n\tgl_FragColor = color;\n}");b.useProgram(d);this.makeTextImage2D(d,1,"u_colorTable",a.length,1,b.LUMINANCE,b.UNSIGNED_BYTE,a);this.execute(d)}})(window.FivekoGFX);(function(b){function a(a,b){function c(a,c){return e[a+1]-e[c+1]}function f(a){for(var b=0;4>b;b++){var d=a+r[b];if(0===e[d]){e[d]=e[a];var f=h[a+0]+h[d+0]>>>1,g=h[a+0]-h[d+0],k=h[a+1]-h[d+1],l=h[a+2]-h[d+2];e[d+1]=Math.sqrt(((512+f)*g*g>>8)+4*k*k+((767-f)*l*l>>8));q.push(d,c)}}}for(var e=new a.data.constructor(new ArrayBuffer(a.data.length)),h=a.data,q=new d,r=[-4,4,4*-a.width,4*a.width],m=4*a.width,k=0,l=m*a.height;k<m;k+=4)e[k]=e[k+l]=255;k=0;for(l=a.height*m;k<l;k+=m)e[k]=e[k+m-1]=255;k=0;for(l=
b.length;b[k];k++)for(var l=b[k].pixels,p=0,t=l.length;p<t;p++)e[l[p]]=80*(k+1),f(l[p]);for(;!q.empty();)l=q.pop(),f(l);k=m+4;for(l=m*a.height-m;k<l;k+=4)160==e[k]&&(h[k+1]=h[k+2]=255*r.reduce(function(a,c){return a|e[k]^e[k+c]},0))}var d=function(){this.nodes=[]};d.prototype.push=function(a,b){for(var c=this.nodes,d=0,e=c.length;d<e;){var f=d+e>>>1;0>b(a,c[f])?d=f+1:e=f}c.splice(d,0,a)};d.prototype.pop=function(){return this.nodes.pop()};d.prototype.empty=function(){return 0===this.nodes.length};
d.prototype.size=function(){return this.nodes.length};b.prototype.watershed=function(b,d){var c=b.getContext("2d"),f=c.getImageData(0,0,b.width,b.height);a(f,d);c.putImageData(f,0,0)}})(window.FivekoGFX);(function(b){b.prototype.histogram=function(a){a=this.getImageData(a.x,a.y,a.w,a.h).data;for(var b=Array.from({length:3},function(){return new Uint32Array(256)}),f=0,h=a.length;f<h;f+=4)b[0][a[f+0]]++,b[1][a[f+1]]++,b[2][a[f+2]]++;return b};b.prototype.equalize=function(a){var b=0,f=0;a=a.map(function(a){f+=a;b=b||f;return f});return Uint8Array.from(a,function(a){return 0<a?255*(a-b)/(f-b):0})};b.prototype.normalize=function(a){var b=Math.min.apply(null,a),f=Math.max.apply(null,a)-b||1;return Uint8Array.from(a,
function(a){return 255*(a-b)/f})}})(window.FivekoGFX);
